# ILTIS - an _Interactive Labeled-Trial Image-stack Slicer_

![screenshot](https://github.com/grg2rsr/ILTIS/blob/master/docs/screenshot.png  "ILTIS screenshot")

## General description

This program was designed to interactively and flexibly slice datasets from functional imaging experiments along the time axis. A classical imaging experiment generates higher dimensional data sets: The individual imaging _trials_, e.g. the response of a certain area to a stimulus is usually imaged as `(x,y)` images over time `(t)`, resulting in 3d image stacks. Additionally, different _stimuli_ (S) are given with a certain number of _repetitions_ `(R)`, resulting in 5 dimensional data `(x,y,t,S,R)`.

This program is designed to slice this type of data along the temporal axis in _time traces_, and sort them according to _stimulus class_ `S` and _repetition `R`. While this is in principle possible with ImageJ/Fiji macros (because basically anything is in principle possible with their macros), this program offers great flexibility in terms of selective data display, intensity scaling, color maps, overlays, ROI handling, data subselection and trace visualization.

## Usage
### Loading data
The program is still in a very early developmental stage, but already usable. Load your data from the `load` menu, trial labels can be added with the `load labels` function. Label files are expected to consist of a label in each line, with the index of each line corresponding to the respective data set. For example, if you want to load the files

+ my_trial_1.tif
+ my_trial_2.tif
+ my_trial_3.tif
+ my_trial_4.tif

and in your experiment trial 1 and 3 were `stimulus A`, 2 and 4 were `stimulus B`, then the label file has to look like

> stimulus_A  
stimulus_B  
stimulus_A  
stimulus_B  

#### File format support
Fully supported are currently any `.tif` files,  Zeiss `.lsm` files generated by pre Zen LSM 510 software (later ones might work) and `.pdb` files from TILL Vision imaging setups. Imports for other formats can be developed, please post a request and send me an example file.

### Frame visualization
To subset the currently displayed data set use the `Data Selector` on the top right. It supports intuitive `ctrl+click`, `shift+click`, `ctrl+a` etc. to select or deselect individual trials to display. The mode of display can be set with the centrally position icons, for example switch between dF/F raw display, average over frames, or a _monochrome_ mode for individual trials with the raw data as the background optionally overlaid with the dF/F signal in a glow colormap.

### Preprocessing
Currently the datasets can be gaussian filtered along image and time axes, by convolving the x,y,t image stack with a gaussian kernel of size set in the options window. Frames that go into the background image for dF/F calculation can also be specified in the options window.

### ROI functionality
ROIs are added by simply clicking on the image, the type of ROI (circular or polygonal) can be selected in the extra `Options` window, opened by clicking on the icon in the toolbar. The `ROI Manager` supports the same multiple selection of ROIs just as the `Data Selector`

### Traces visualization
Depending on the selected datasets and the activated ROIs, the displayed data is sliced along the time domain under the area covered by the ROIs, each frames values are averaged. The sliced traces are color coded and can be displayed in two ways: All traces with a common time base, or sorted to stimulus identity. Both windows are tabbed below the frame display, but can also be detached by clicking on the blue tab and dragging them (for example to a separate screen). Traces are interactively updated upon any change to the ROIs or data selection.

### Traces export
After setting up all ROIs, the dataset can be sliced according to the pixels covered by the ROIs. The average value of those pixels for each frame is calculated and the resulting vectors can be written in different ways into `.csv` files:

+ `.csv - normal` writes one file per loaded dataset, with the shape (t,ROI). 
+ `.csv - sorted` writes one file per ROI and stimulus combination, with the individual columns representing the repetitions.

If a `dt` value is specified in the Options, the corresponding time vector is calculated and added to the first column of the `.csv`, with the stimulus start being set to 0, pre stimulus times are thus negative.

## Installation
Installation script is coming soon. Until then, just run the `run.sh` if you are on Linux or just directly `python Main.py`.

### Dependencies
+ sicpy >= 0.13.3
+ PyQt4 >= 4.10.1
+ pyqtgraph >= 0.9.8 (now included in main)
+ scikit image >= 0.11.3

All were pulled either through pip install or through linux package manager, so no manual installation of any extras is needed.

### Coming soon
+ rigid and nonlinear transformation based movement correction
+ activity based calculation of ROIs
+ Python OO based data export